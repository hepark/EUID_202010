[â† BACK](./README.md)

# DAY 04 (2020-10-22, ëª©)

### Virtual DOMğŸ¤¸â€â™€ï¸

#### Part 00. í™˜ê²½ì„¤ì •ğŸ”§

0. [virtual-dom](https://github.com/Matt-Esch/virtual-dom)?  
   A JavaScript DOM(Document Object Model) model supporting element creation, diff computation and path operations for efficient re-rendering

1. npmì„ ì‚¬ìš©í•˜ì—¬ budoë¼ëŠ” íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.

```sh
# package.json íŒŒì¼ì„ ìƒì„±í•œë‹¤.
$ npm init -y

# ê°œë°œ ë²„ì „ìœ¼ë¡œ budoë¥¼ ì„¤ì¹˜í•œë‹¤.
$ npm i -D budo
```

2. `package.json` íŒŒì¼ì˜ ë‚´ìš©ì„ ì•„ë˜ì™€ ê°™ì´ ë³€ê²½í•œë‹¤.  
   ![package.json íŒŒì¼ ë‚´ìš© ë³€ê²½](./assets/week01_thr01.png "package.json íŒŒì¼ ë‚´ìš© ë³€ê²½")

3. virtual DOMì„ ì„¤ì¹˜í•œë‹¤.

```sh
# virtual-DOMì„ ì„¤ì¹˜í•œë‹¤.
$ npm i -S virtual-DOM
```

ì´ì œ `package.json` íŒŒì¼ì„ ë³´ë©´ `dependencies`ì— `virtual-DOM`ì´ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
![virtual DOM ì„¤ì¹˜](./assets/week01_thr02.png "virtual DOM ì„¤ì¹˜")

4. `index.js` íŒŒì¼ê³¼ `index.html` íŒŒì¼ì„ ìƒì„±í•œë‹¤.

```sh
# index.html
<!DOCtype html>
<html lang="ko-KR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>ê°€ìƒ DOM í•™ìŠµ</title>
</head>

<body>
    # index.js í˜¸ì¶œ
    <script src="index.js"></script>
</body>

</html>
```

5.  `npm start`

![virtual DOM ì‹¤í–‰](./assets/week01_thr03.png "virtual DOM ì‹¤í–‰")

ğŸ‘‰ì—¬ê¸°ê¹Œì§€ í•˜ê³  `http://192.168.35.45:9966/`ì— ì ‘ì†í•˜ë©´ <ins>ê°€ìƒ DOM í•™ìŠµ</ins>ì´ë¼ëŠ” íƒ­ì˜ ë¹ˆ í˜ì´ì§€ê°€ ë‚˜ì˜¨ë‹¤.

#### Part 01. ì‹¤ì œ DOM model ì»¨íŠ¸ë¡¤ğŸ”§

6. `index.js` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•´ë³¸ë‹¤.

```sh
# index.js
// Actual DOM
var actual_dom = document.createElement("p");

actual_dom.innerHTML = "Actual DOM";

document.body.appendChild(actual_dom);
```

![actual DOM ì‹¤í–‰](./assets/week01_thr04.png "actual DOM ì‹¤í–‰")

#### Part 2. ê°€ìƒ DOM model ì»¨íŠ¸ë¡¤ğŸ”§

`virtual-dom`ì€ ë‹¤ìŒì˜ ë„¤ ê°€ì§€ ëª¨ë“ˆì„ ì§€ì›í•œë‹¤.

- For `create-element.js`see the [vdom README](https://github.com/Matt-Esch/virtual-dom/blob/master/vdom/README.md)
- For `diff.js` see the [vtree README](https://github.com/Matt-Esch/virtual-dom/blob/master/vtree/README.md)
- For `h.js` see the [virtual-hyperscript README](https://github.com/Matt-Esch/virtual-dom/blob/master/virtual-hyperscript/README.md)
- For `patch.js` see the [vdom README](https://github.com/Matt-Esch/virtual-dom/blob/master/vdom/README.md)

7. `h.js`ë¡œ <ins>virtual tree</ins>ë¥¼ ë§Œë“ ë‹¤.
   `virtual-hyperscript`ëŠ” virtual treeë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.  
   ![Example - creating a VTree using virtual-hyperscript](./assets/week01_thr05.png "Example - creating a VTree using virtual-hyperscript")

ìœ„ì˜ ì˜ˆì‹œë¥¼ ì°¸ì¡°í•˜ì—¬ `index.js` íŒŒì¼ì— ì•„ë˜ì™€ ê°™ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•œë‹¤.

```sh
# virtual-domì— ìˆëŠ” h ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¨ë‹¤
var h = require("virtual-dom/h");

// Virtual DOM
# h ëª¨ë“ˆì´ ë¬´ì—‡ì¸ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ typeofë¥¼ ì°ì–´ë³¸ë‹¤
console.log(typeof h);
```

í˜ì´ì§€ì˜ ì½˜ì†” ì°½ì„ ë³´ë©´ `virtual-dom`ì˜ `h` ëª¨ë“ˆ ìœ í˜•ì€ <ins>function</ins>ì„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
![h ëª¨ë“ˆì˜ type](./assets/week01_thr06.png "h ëª¨ë“ˆì˜ type")

```sh
# virtual-domì— ìˆëŠ” h ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¨ë‹¤
var h = require("virtual-dom/h");

// Virtual DOM
var tree = h('p', 'virtual dom')

console.log(tree)
```

í˜ì´ì§€ì˜ ì½˜ì†” ì°½ì„ ë³´ë©´ `Virtual Mode`ê°€ ìƒì„±ë˜ì–´ ìˆê³ , `tagName`ì€ `p`, `Virtual Text`ì˜ `text`ëŠ” `virtual dom`ì„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
![Virtual Mode ì‚´í´ë³´ê¸°](./assets/week01_thr07.png "Virtual Mode ì‚´í´ë³´ê¸°")

8. `create-element.js`ë¡œ ì•ì„œ ìƒì„±í•œ treeë¥¼ ì‹¤ì œ html elementì— ë¶™ì—¬ë³¸ë‹¤.
   ![Example - create-element.js](./assets/week01_thr08.png "Example - create-element.js")

```sh
# index.js
var h = require("virtual-dom/h");
var createElement = require("virtual-dom/create-element");

// Actual DOM
# ê°€ìƒìœ¼ë¡œ treeë¥¼ ë§Œë“ ë‹¤
var tree = h("p", "virtual dom");
# elementë¥¼ ìƒì„±í•œë‹¤
var rootNode = createElement(tree);
# body ìš”ì†Œì— elementë¥¼ ë¶™ì—¬ì¤€ë‹¤
document.body.appendChild(rootNode);
```

![create-element.js](./assets/week01_thr09.png "create-element.js")

#### Part 3. ê°€ìƒ DOM ê°€ìƒ íŠ¸ë¦¬ ë¹„êµ í›„, íŒ¨ì¹˜ğŸ”§

9. `diff.js`ë¡œ ê¸°ì¡´ ë…¸ë“œì™€ ë³€ê²½ ì‚¬í•­ì„ ê°ì§€í•œë‹¤.
   ![diff.js](./assets/week01_thr10.png "diff.js")

10. `patch.js`ë¡œ ë³€ê²½ ì‚¬í•­ì„ rootNodeì— ì ìš©í•œë‹¤.
    ![patch.js](./assets/week01_thr11.png "patch.js")

```sh
# index.js
var h = require("virtual-dom/h");
var createElement = require("virtual-dom/create-element");
var diff = require("virtual-dom/diff");
var patch = require("virtual-dom/patch");


// Virtual DOM

var count = 0;

function render(n) {
  return h("p", "virtual dom" + n);
}

function update() {
  // ìƒˆë¡œìš´ ê°€ìƒ íŠ¸ë¦¬ë¥¼ ìƒì„±
  var newTree = render(++count);
  // ê¸°ì¡´ ê°€ìƒ íŠ¸ë¦¬, ìƒˆë¡œìš´ ê°€ìƒ íŠ¸ë¦¬í•˜ê³  ë³€ê²½ì ì´ ìˆëŠ”ì§€ í™•ì¸
  var patches = diff(tree, newTree);
  // ë³€ê²½ì‚¬í•­ì´ ë°œìƒí•˜ë©´ rootNodeì— íŒ¨ì¹˜
  patch(rootNode, patches);
}

var tree = render(count);
var rootNode = createElement(tree);

document.body.appendChild(rootNode);

window.setInterval(function () {
  update();
}, 1400);

```

![diff.js, patch.js](./assets/week01_thr11.gif "diff.js, patch.js")

#### Part 4. ê°€ìƒ DOM ë°°ì—´ ë°ì´í„° ìˆœí™˜ ì²˜ë¦¬ğŸ”§

11. `count` ëŒ€ì‹  `ë°°ì—´ ë°ì´í„°`ë¥¼ ì ìš©í•´ë³¸ë‹¤.

```sh
# index.js
var h = require("virtual-dom/h");
var createElement = require("virtual-dom/create-element");
var diff = require("virtual-dom/diff");
var patch = require("virtual-dom/patch");


// Virtual DOM

var data = [
    "vue.js",
    "angular",
    "react"
    ];

function render(data) {
  var lists = data.map(function (item, index) {
    return h("li", item);
  });
  return h("ul", lists);
}

function update() {
  // ìƒˆë¡œìš´ ê°€ìƒ íŠ¸ë¦¬ë¥¼ ìƒì„±
  var newTree = render(data);
  // ê¸°ì¡´ ê°€ìƒ íŠ¸ë¦¬, ìƒˆë¡œìš´ ê°€ìƒ íŠ¸ë¦¬í•˜ê³  ë³€ê²½ì ì´ ìˆëŠ”ì§€ í™•ì¸
  var patches = diff(tree, newTree);
  // ë³€ê²½ì‚¬í•­ì´ ë°œìƒí•˜ë©´ rootNodeì— íŒ¨ì¹˜
  patch(rootNode, patches);
}

var tree = render(data);
var rootNode = createElement(tree);

document.body.appendChild(rootNode);

window.setInterval(function () {
  update();
}, 1400);

```

![ê°€ìƒ DOM ë°°ì—´ ë°ì´í„° ìˆœí™˜ ì²˜ë¦¬](./assets/week01_thr12.png "ê°€ìƒ DOM ë°°ì—´ ë°ì´í„° ìˆœí™˜ ì²˜ë¦¬")

#### Part 5. ê°€ìƒ DOM ì œê±° ë²„íŠ¼ğŸ”§

12. ì•„ì´í…œì„ ì§€ìš¸ ìˆ˜ ìˆëŠ” `delete` ë²„íŠ¼ì„ ì¶”ê°€í•´ë³¸ë‹¤.

```sh
var h = require("virtual-dom/h");
var createElement = require("virtual-dom/create-element");
var diff = require("virtual-dom/diff");
var patch = require("virtual-dom/patch");

var data = ["vue.js", "angular", "react"];

function render(data) {
  var deleteBtn = h("button", { type: "button" }, "delete");
  var lists = data.map(function (item, index) {
    return h("li", [item, deleteBtn]);
  });
  return h("ul", lists);
}

function update() {
  // ìƒˆë¡œìš´ ê°€ìƒ íŠ¸ë¦¬ë¥¼ ìƒì„±
  var newTree = render(data);
  // ê¸°ì¡´ ê°€ìƒ íŠ¸ë¦¬, ìƒˆë¡œìš´ ê°€ìƒ íŠ¸ë¦¬í•˜ê³  ë³€ê²½ì ì´ ìˆëŠ”ì§€ í™•ì¸
  var patches = diff(tree, newTree);
  // ë³€ê²½ì‚¬í•­ì´ ë°œìƒí•˜ë©´ rootNodeì— íŒ¨ì¹˜
  patch(rootNode, patches);
}

var tree = render(data);
var rootNode = createElement(tree);

document.body.appendChild(rootNode);
```

![deleteBtn ì¶”ê°€](./assets/week01_thr13.png "deleteBtn ì¶”ê°€")

13. ì•ì„œ ë§Œë“  `delete` ë²„íŠ¼ì— ì´ë²¤íŠ¸ë¥¼ ë°”ì¸ë”©í•œë‹¤.

```sh
var h = require("virtual-dom/h");
var createElement = require("virtual-dom/create-element");
var diff = require("virtual-dom/diff");
var patch = require("virtual-dom/patch");

var data = ["vue.js", "angular", "react"];

function render(data) {
  var lists = data.map(function (item, index) {
    return h("li", [
      item,
      h(
        "button",
        {
          type: "button",
          onclick: function (e) {
            // ëª¨ë¸ ë°ì´í„° ë³€ê²½
            data.splice(index, 1);
            console.log("data");
            // í™”ë©´ ë·° ì—…ë°ì´íŠ¸
            update();
          },
        },
        "delete"
      ),
    ]);
  });

  var list = h("ul", lists);

  return list;
}

function update() {
  // ìƒˆë¡œìš´ ê°€ìƒ íŠ¸ë¦¬ë¥¼ ìƒì„±
  var newTree = render(data);
  // ê¸°ì¡´ ê°€ìƒ íŠ¸ë¦¬, ìƒˆë¡œìš´ ê°€ìƒ íŠ¸ë¦¬í•˜ê³  ë³€ê²½ì ì´ ìˆëŠ”ì§€ í™•ì¸
  var patches = diff(tree, newTree);
  // ë³€ê²½ì‚¬í•­ì´ ë°œìƒí•˜ë©´ rootNodeì— íŒ¨ì¹˜
  patch(rootNode, patches);
}

var tree = render(data);
var rootNode = createElement(tree);

document.body.appendChild(rootNode);
```

![ê°€ìƒ DOM deleteBtn](./assets/week01_thr14.gif "ê°€ìƒ DOM deleteBtn")

#### Part 6. ê°€ìƒ DOM ì¶”ê°€ ë²„íŠ¼ğŸ”§

14. ì‚­ì œ ë²„íŠ¼ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì¶”ê°€ ë²„íŠ¼ì„ ë§Œë“¤ê³  ì´ë²¤íŠ¸ë¥¼ ë°”ì¸ë”©í•œë‹¤.

```sh
var h = require("virtual-dom/h");
var createElement = require("virtual-dom/create-element");
var diff = require("virtual-dom/diff");
var patch = require("virtual-dom/patch");

var data = ["vue.js", "angular", "react"];

function render(data) {
  var lists = data.map(function (item, index) {
    return h("li", [
      item,
      h(
        "button",
        {
          type: "button",
          onclick: function (e) {
            // ëª¨ë¸ ë°ì´í„° ë³€ê²½
            data.splice(index, 1);
            console.log("data");
            // í™”ë©´ ë·° ì—…ë°ì´íŠ¸
            update();
          },
        },
        "delete"
      ),
    ]);
  });

  var list = h("ul", lists);

  var input = h("input.add-content", {
    type: "text",
    placeholder: "Add Favorite Framework",
  });

  var add_btn = h(
    "button.add-btn",
    {
      type: "button",
      onclick: function (e) {
        var input = document.querySelector(".add-content");
        // ëª¨ë¸ ë°ì´í„° ì—…ë°ì´íŠ¸
        data.push(input.value);
        // í™”ë©´ ë·° ì—…ë°ì´íŠ¸
        update();
        // ì¸í’‹ ì´ˆê¸°í™”
        input.value = "";
      },
    },
    "Add"
  );

  var container = h("div.container", [input, add_btn, list]);

  return container;
}

function update() {
  // ìƒˆë¡œìš´ ê°€ìƒ íŠ¸ë¦¬ë¥¼ ìƒì„±
  var newTree = render(data);
  // ê¸°ì¡´ ê°€ìƒ íŠ¸ë¦¬, ìƒˆë¡œìš´ ê°€ìƒ íŠ¸ë¦¬í•˜ê³  ë³€ê²½ì ì´ ìˆëŠ”ì§€ í™•ì¸
  var patches = diff(tree, newTree);
  // ë³€ê²½ì‚¬í•­ì´ ë°œìƒí•˜ë©´ rootNodeì— íŒ¨ì¹˜
  patch(rootNode, patches);
  // tree ë³€ìˆ˜ ê°’ ì—…ë°ì´íŠ¸
  tree = newTree;
}

var tree = render(data);
var rootNode = createElement(tree);

document.body.appendChild(rootNode);

```

![ê°€ìƒ DOM addBtn](./assets/week01_thr15.gif "ê°€ìƒ DOM addBtn")
